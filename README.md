# `DVA-C02`

# `AWS Well-Architected Framework`

- Operational excellence
- Security
- Reliability
- Performance efficiency
- Cost optimization
- Sustainability

## The Shared Responsibility Model

**CUSTOMER** (Responsible for the security _in_ the cloud)

- Customer Data
- Platform, Apps, IAM
- OS, Network & Firewall Configuration
- Client-side data encryption & data integrity authentication
- Server-side encryption
- Network Traffic Protection

**AWS** (Responsible for the security _of_ the cloud)

- Software
- Compute, Storage, Database, Networking
- Hardware
- Regions, AZs, Edge locations

# `Identity & Access Management`

- Offers a centralized hub of control within AWS and integrates with all other AWS Services
- Allows you to manage users and their level of access to the AWS console.

> When you create a new account the _root user_ will be created which will have all permissions and access to all the resources.
> **It's very important to secure your root user**

- `User` : Individual AWS user.

  - 5000 IAM users limit per account.
  - Any IAM user can only be member of 10 groups.

  > IAM user will be implicitely denied to usage and costs section even if he's admin

- `Groups` : Collection of similar people with shared permissions & users will inherit permissions from the group.

  **It's best to inherit permissions from groups so that you don't have to manage them individually**

- `Roles` : Temporary Security Credentials.
  Assigned to any software service that needs to be granted permissions to do its job. - Temporary Credentials are by generated by Secure Token Service (STS).

      It's similar to IAM user, however instead of being assiciated with one person , a role is intended to be assumed by anyone who needs it.
      - Use roles in situations like cross account resource acceess.

      *Two types of policies are attached to a role :*
      - Trust Policy : Who can assume this role?
      - Permission Policy : What can they do after assuming the role?

- `Policies` : A policy is an JSON file in AWS that, when associated with an identity or resource, defines their permissions.

  - Inline : Assign policy individually
  - Managed : Assign different identities to single policy.

- `ARN` : Amazon Resource Name
  - arn:partition:service:region:account-id:resource-id
  - arn:partition:service:region:account-id:resource-type:resource-id
  - arn:partition:service:region:account-id:resource-type:resource-id

#### Permission Priority

> _Explicit Deny > Explicit Allow > Default(Implicit Deny)_

#### IAM Security Tools

- **IAM Credentials Report** (account-level) - lists all of the users and the status of their credentials
- **IAM Access Advisor** (user-level) - shows the service permissions granted to a user and when those services were last accessed.

# `Elastic Compute Cloud`

It's just VMs with on-demand price and scalable compute capacity option.

> You will be charged for the AMI, Instance Type, EBS Volume, Networking, IOs, Snapshots.

- Infrastructure-as-a-service.
- Configuration options :
  - OS
  - Compute Power & Cores(CPU)
  - RAM
  - Storage space
    - Network Attached(EBS & EFS)
    - Hardware Attached(Instance Store)
  - Network Card : speed of the card, kind of public IP
  - Firewall rules(security groups)
  - Bootstrap Script(EC2 user data)

> Note: Apache HTTPD is an HTTP server daemon produced by the Apache Foundation. It is a piece of software that listens for network requests (which are expressed using the Hypertext Transfer Protocol) and responds to them. It is open source and many entities use it to host their websites. Other HTTP servers are available (including Apache Tomcat which is designed for running server side programs written in Java (which don't use CGI)). CGI is a protocol that allows an HTTP server to use an external piece of software to determine how to respond to a request instead of simply returning the contents of a static file. Many HTTP servers support the CGI protocol. You can use CGI without an HTTP server, but this typically has few uses beyond allowing a developer to perform command line testing of the CGI program. (You certainly can't interact with it directly from a web browser).

- EC2 instance types:
  - General Purpose(T)
  - Compute Optimized(C)
  - Memory Optimized(R,X,Z)
  - Accelerated Computing()
  - Storage Optimized(I,D,H)
  - Instance Features
  - Measuring Instance Performance

Ex: m5.2xlarge

m -> instance class
5 -> generation
2xlarge -> size within the instance class

## Security Groups

- Controls inbound and outbound traffic
- Only contains allow rules
- Acts as firewall for EC2 instances
- Regulates:
  - Access to ports
  - Authorized IP ranges
  - Controls of Inbound Network(from other to instance)
  - Controls of Outbound Network(from instance to other)
- Can be attached to multiple instances
- If your application is not accesible(or timed out), then it's most probably security group issue
- And if it's "connection refused" then it's application error or it's not launched
- All inbound traffic is blocked by default
- All outbound is authorized by default

```
Classic Ports:
22 - SSH
21 - FTP
22 - SFTP
80 - HTTP
443 - HTTPS
3389 - RDP
```

\*_Creating KeyPair for ec2 does not cost anything_

**Pricing Options** :

- _On-Demand Instance_ :
  - No upfront payment or long-term commitment, just pay by the hour.
  - Used for Application with short-term , spiky or unpredictable workloads that cannot be interrupted.
- _Reserved Instances_ (1 & 3 Y):
  - Reserved instance : for long workloads
  - Convertible Reserved instance : long workloads with flexible instances
- _Savings Plan_ (1 & 3 Y): Commitment to an amount of usage, long workload
- _Spot Instance_ : short workloads, cheap, can lose instances (less reliable).
- _Dedicated Hosts_ :
  - Book entire physical server control instance placement.
  - An Amazon EC2 Dedicated Host is a physical server fully dedicated for your use.
  - Amazon EC2 Dedicated Hosts allow you to use your eligible software licenses from vendors such as Microsoft and Oracle on Amazon EC2, so that you get the flexibility and cost effectiveness of using your own licenses, but with the resiliency, simplicity and elasticity of AWS.
- _Dedicated Instances_ : no other customers will share your hardware.
- _Capacity Reservations_ : reserve capacity in a specific AZ for any duration

### Instance States :

| Instance state  | Description                                                                                                                                                                                 | Billing                                                           |
| --------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------- |
| `pending`       | The instance is preparing to enter the `running` state. An instance enters the pending state when it launches for the first time, or when it is started after being in the `stopped` state. | Not billed                                                        |
| `running`       | The instance is running and ready for use.                                                                                                                                                  | Billed                                                            |
| `stopping`      | The instance is preparing to be stopped or stop-hibernated.                                                                                                                                 | Not billed if preparing to stop. Billed if preparing to hibernate |
| `stopped`       | The instance is shut down and cannot be used. The instance can be started at any time.                                                                                                      | Not billed                                                        |
| `shutting-down` | The instance is preparing to be terminated.                                                                                                                                                 | Not billed                                                        |
| `terminated`    | The instance has been permanently deleted and cannot be started.                                                                                                                            | Not billed                                                        |

## EC2 - Instance Storage :

### EBS Volume :

- An EBS (Elastic Block Store) Volume is a network drive you can attach to your instances while they run.
- It allows your instances to persist data, even after their termination
- They are bound to a specific availability zone
  > Free tier: 30 GB of free EBS storage of type General Purpose (SSD) or
  > Magnetic per month
- It uses the network to communicate the instance, which means there might be a bit of latency
- It can be detached from an EC2 instance and attached to another one quickly
- An EBS Volume in us-east-1a cannot be attached to us-east-1b, To move a volume across, you first need to snapshot it
- You get billed for all the provisioned capacity, You can increase the capacity of the drive over time

**EBS – Delete on Termination attribute**

- Controls the EBS behaviour when an EC2 instance terminates
- By default, the root EBS volume is deleted (attribute enabled)
- By default, any other attached EBS volume is not deleted (attribute disabled), This can be controlled by the AWS console / AWS CLI

**EBS Snapshots :**

- Make a backup (snapshot) of your EBS volume at a point in time
- Not necessary to detach volume to do snapshot, but recommended
- Can copy snapshots across AZ or Region
- EBS Snapshots Features :
  - EBS Snapshot Archive :
    - Move a Snapshot to an ”archive tier” that is 75% cheaper
    - Takes within 24 to 72 hours for restoring the archive
  - Recycle Bin for EBS Snapshots :
    - Setup rules to retain deleted snapshots so you can recover them after an accidental deletion
    - Specify retention (from 1 day to 1 year)
  - Fast Snapshot Restore (FSR) :
    - Force full initialization of snapshot to have no latency on the first use ($$$)

### AMI (Amazon Machine Image) : 

An Amazon Machine Image (AMI) is an image that provides the software that is required to set up and boot an Amazon EC2 instance. 
- AMI are a customization of an EC2 instance
- AMI are built for a specific region (and can be copied across regions)
- You can launch EC2 instances from :
    - Public AMI (AWS provided)
    - Own AMI
    - AWS MarketPlace AMI 

### EC2 Instance Store :
- High-performance hardware disk attached to your instance
- Better I/O performance
- Lose data if they're stopped(ephemeral)
- Use Cases :
    - Buffer
    - cache
    - scratch data
    - temporary content
- Includes risk of data loss if hardware fails
- So backup and replication is your responsibility

### EBS Volume Types :
- **General Purpose SSD** : Used for System boot volumes, Virtual desktops, Development and test environments. 
    - gp2
    - gp3
- **Provisioned IOPS (PIOPS) SSD** : Used for Critical business applications with sustained IOPS performance. Or applications that need more than 16,000 IOPS. Great for databases workloads (sensitive to storage perf and consistency).
    - io1
    - io2
    - EBS Multi-Attach feature -
        - Can attach the same EBS volume to multiple EC2 instances in the *same AZ*
        - Each instance has full read & write permissions to the high-performance volume
        - Use case:
            - Achieve higher application availability in clustered Linux applications (ex: Teradata)
            - Applications must manage concurrent write operations
            - Up to 16 EC2 Instances at a time
            - Must use a file system that’s cluster-aware (not XFS, EXT4, etc…)
- **Hard Disk Drives (HDD)** : Cannot be a boot volume, 125 GiB to 16 TiB.
    - Throughput Optimized HDD (st1) : Used for Big Data, Data Warehouses, Log Processing.
    - Cold HDD (sc1) : Used for data that is infrequently accessed and Scenarios where lowest cost is important.

### Amazon EFS(Elastic File System) 
- It's a managed NFS (network file system) that can be mounted on many EC2
- EFS works with EC2 instances in *multi-AZ*
- Highly available, scalable, expensive, pay per use
- Use cases: content management, web serving, data sharing, Wordpress
- Uses NFSv4.1 protocol
- Uses security group to control access to EFS
- Compatible with Linux based AMI (not Windows)
- Encryption at rest using KMS
- POSIX file system (~Linux) that has a standard file API
- File system scales automatically, pay-per-use, no capacity planning!
- **EFS – Performance Classes**:
    - EFS Scale : 
        - 1000s of concurrent NFS clients, 10 GB+ /s throughput
        - Grow to Petabyte-scale network file system, automatically
    - Performance Mode (set at EFS creation time) : 
        - General Purpose (default) – latency-sensitive use cases (web server, CMS, etc…)
        - Max I/O – higher latency, throughput, highly parallel (big data, media processing)
    - Throughput Mode : 
        - Bursting – 1 TB = 50MiB/s + burst of up to 100MiB/s
        - Provisioned – set your throughput regardless of storage size, ex: 1 GiB/s for 1 TB storage
        - Elastic – automatically scales throughput up or down based on your workloads
            - Up to 3GiB/s for reads and 1GiB/s for writes
            - Used for unpredictable workloads
- **EFS – Storage Classes**: 
    - Storage Tiers (lifecycle management feature – move file after N days) : 
        - Standard: for frequently accessed files
        - Infrequent access (EFS-IA): cost to retrieve files, lower price to store. 
        - Archive: rarely accessed data (few times each year), 50% cheaper
        - Implement lifecycle policies to move files between storage tiers
    - Availability and durability :
        - Standard: Multi-AZ, great for prod
        - One Zone: One AZ, great for dev, backup enabled by default, compatible with IA (EFS One Zone-IA)

Vertical Scaling : Increase instance size

Horizontal Scaling : Increase number of instances

High Availability : Running instance for the same app across multi AZ

## Elastic Load Balancer
Load Balances are servers that forward traffic to multiple
servers (e.g., EC2 instances) downstream
- Spread load across multiple downstream instances
- Expose a single point of access (DNS) to your application
- Seamlessly handle failures of downstream instances
- Do regular health checks to your instances
- Provide SSL termination (HTTPS) for your websites
- Enforce stickiness with cookies
- High availability across zones
- Separate public traffic from private traffic
- Health checks are done on the EC2 instances to know if instances it forwards traffic to are available to reply to requests
- The health check is done on a port and a route (/health is common) If the response is not 200 (OK), then the instance is unhealthy

### Types of load balancers : 
- **Classic Load Balancer(depricated)**
    - for HTTP, HTTPS, TCP, SSL (secure TCP)
- **Application Load Balancer**
    - for HTTP, HTTPS, WebSocket
    - works on layers 7
    - used for both VMs and containers
    - support redirect http to https
    - Routing
        - routes based on path in URL
        - routes based on hostname in URL
        - routes based on Query String, Headers
    - has a port matching feature to redirect to a dynamic port in ECS
    - can use 1 ALB for multiple applications
    - The application servers don’t see the IP of the client directly
        - The true IP of the client is inserted in the header X-Forwarded-For
        - We can also get Port (X-Forwarded-Port) and proto (X-Forwarded-Proto)
    - Target Groups
        - EC2 instances (can be managed by an Auto Scaling Group) – HTTP
        - ECS tasks (managed by ECS itself) – HTTP
        - Lambda functions – HTTP request is translated into a JSON event
        - IP Addresses – must be private IPs
- **Network Load Balancer**
    - for TCP, TLS (secure TCP), UDP
    - works on layer 4
    - Forward TCP & UDP traffic to your instances
    - ideal for Handling millions of request per seconds
    - NLB has one static IP per AZ, and supports assigning Elastic IP(helpful for whitelisting specific IP)
    - Target Groups
        - EC2 instances
        - IP Addresses – must be private IPs
        - Application Load Balancer
- **Gateway Load Balancer**
    - Operates at layer 3 (Network layer) – IP Protocol
    - it basically acts like a middle b/w your application and you that way you can perform certain action to the user before user get to the ALB
      - example : Firewalls, Intrusion detection and prevention systems, deep packet inspection systems, payload manipulation
    - basically used for security purposes
    - Uses the GENEVE protocol on port 6081
    - Target Groups
        - EC2 instances
        - IP Addresses – must be private IPs
> Load balancers can also be setup to only allow traffic that passes through the load balancer

- **Sticky Sessions**: 